-- macOS Style UI Library (Light Theme + Settings)
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local Library = {}
Library.Flags = {}
Library.Theme = "Light"

-- Color Themes
local Themes = {
    Light = {
        Background = Color3.fromRGB(245, 245, 247),
        Sidebar = Color3.fromRGB(255, 255, 255),
        SidebarHover = Color3.fromRGB(235, 235, 240),
        Selected = Color3.fromRGB(0, 122, 255),
        Element = Color3.fromRGB(255, 255, 255),
        TopBar = Color3.fromRGB(250, 250, 252),
        Text = Color3.fromRGB(0, 0, 0),
        TextDark = Color3.fromRGB(100, 100, 105),
        Accent = Color3.fromRGB(0, 122, 255),
        Border = Color3.fromRGB(220, 220, 225),
        Shadow = Color3.fromRGB(0, 0, 0)
    },
    Dark = {
        Background = Color3.fromRGB(25, 25, 28),
        Sidebar = Color3.fromRGB(20, 20, 23),
        SidebarHover = Color3.fromRGB(35, 35, 38),
        Selected = Color3.fromRGB(236, 72, 153),
        Element = Color3.fromRGB(35, 35, 38),
        TopBar = Color3.fromRGB(30, 30, 33),
        Text = Color3.fromRGB(255, 255, 255),
        TextDark = Color3.fromRGB(160, 160, 165),
        Accent = Color3.fromRGB(59, 130, 246),
        Border = Color3.fromRGB(45, 45, 48),
        Shadow = Color3.fromRGB(0, 0, 0)
    }
}

local Colors = Themes.Light

-- Tween
local function Tween(obj, props, duration)
    TweenService:Create(obj, TweenInfo.new(duration or 0.2, Enum.EasingStyle.Quad), props):Play()
end

-- Create Window
function Library:CreateWindow(title)
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "MacOSUI"
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    ScreenGui.ResetOnSpawn = false
    
    pcall(function()
        if gethui then
            ScreenGui.Parent = gethui()
        else
            ScreenGui.Parent = game.CoreGui
        end
    end)
    
    if not ScreenGui.Parent then
        ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    end
    
    -- Main
    local Main = Instance.new("Frame")
    Main.Name = "Main"
    Main.Parent = ScreenGui
    Main.AnchorPoint = Vector2.new(0.5, 0.5)
    Main.BackgroundColor3 = Colors.Background
    Main.BorderSizePixel = 0
    Main.Position = UDim2.new(0.5, 0, 0.5, 0)
    Main.Size = UDim2.new(0, 900, 0, 550)
    Main.ClipsDescendants = true
    Main.Active = true
    
    local MainCorner = Instance.new("UICorner")
    MainCorner.CornerRadius = UDim.new(0, 10)
    MainCorner.Parent = Main
    
    -- Shadow Effect
    local Shadow = Instance.new("ImageLabel")
    Shadow.Name = "Shadow"
    Shadow.Parent = Main
    Shadow.BackgroundTransparency = 1
    Shadow.Position = UDim2.new(0, -20, 0, -20)
    Shadow.Size = UDim2.new(1, 40, 1, 40)
    Shadow.ZIndex = 0
    Shadow.Image = "rbxasset://textures/ui/GuiImagePlaceholder.png"
    Shadow.ImageColor3 = Colors.Shadow
    Shadow.ImageTransparency = 0.7
    
    -- TopBar
    local TopBar = Instance.new("Frame")
    TopBar.Name = "TopBar"
    TopBar.Parent = Main
    TopBar.BackgroundColor3 = Colors.TopBar
    TopBar.BorderSizePixel = 0
    TopBar.Size = UDim2.new(1, 0, 0, 50)
    
    local TopCorner = Instance.new("UICorner")
    TopCorner.CornerRadius = UDim.new(0, 10)
    TopCorner.Parent = TopBar
    
    local TopFix = Instance.new("Frame")
    TopFix.Parent = TopBar
    TopFix.BackgroundColor3 = Colors.TopBar
    TopFix.BorderSizePixel = 0
    TopFix.Position = UDim2.new(0, 0, 1, -10)
    TopFix.Size = UDim2.new(1, 0, 0, 10)
    
    -- Border Line
    local TopBorder = Instance.new("Frame")
    TopBorder.Parent = TopBar
    TopBorder.BackgroundColor3 = Colors.Border
    TopBorder.BorderSizePixel = 0
    TopBorder.Position = UDim2.new(0, 0, 1, -1)
    TopBorder.Size = UDim2.new(1, 0, 0, 1)
    
    -- Window Buttons
    local function createDot(color, pos)
        local dot = Instance.new("Frame")
        dot.Parent = TopBar
        dot.BackgroundColor3 = color
        dot.BorderSizePixel = 0
        dot.Position = UDim2.new(0, pos, 0, 15)
        dot.Size = UDim2.new(0, 12, 0, 12)
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(1, 0)
        corner.Parent = dot
        
        local btn = Instance.new("TextButton")
        btn.Parent = dot
        btn.BackgroundTransparency = 1
        btn.Size = UDim2.new(1, 0, 1, 0)
        btn.Text = ""
        
        return btn
    end
    
    local CloseBtn = createDot(Color3.fromRGB(255, 95, 87), 15)
    local MinBtn = createDot(Color3.fromRGB(255, 189, 68), 35)
    
    -- Title
    local Title = Instance.new("TextLabel")
    Title.Parent = TopBar
    Title.BackgroundTransparency = 1
    Title.Position = UDim2.new(0, 80, 0, 0)
    Title.Size = UDim2.new(0, 300, 0, 30)
    Title.Font = Enum.Font.GothamBold
    Title.Text = title or "Anime Vanguards [Premium]"
    Title.TextColor3 = Colors.Text
    Title.TextSize = 14
    Title.TextXAlignment = Enum.TextXAlignment.Left
    
    local Subtitle = Instance.new("TextLabel")
    Subtitle.Parent = TopBar
    Subtitle.BackgroundTransparency = 1
    Subtitle.Position = UDim2.new(0, 80, 0, 28)
    Subtitle.Size = UDim2.new(0, 300, 0, 15)
    Subtitle.Font = Enum.Font.Gotham
    Subtitle.Text = "Made by ReaperX Hub"
    Subtitle.TextColor3 = Colors.TextDark
    Subtitle.TextSize = 11
    Subtitle.TextXAlignment = Enum.TextXAlignment.Left
    
    -- Search Bar
    local SearchBar = Instance.new("Frame")
    SearchBar.Parent = TopBar
    SearchBar.BackgroundColor3 = Colors.Element
    SearchBar.BorderSizePixel = 1
    SearchBar.BorderColor3 = Colors.Border
    SearchBar.Position = UDim2.new(1, -250, 0, 12)
    SearchBar.Size = UDim2.new(0, 230, 0, 28)
    
    local SearchCorner = Instance.new("UICorner")
    SearchCorner.CornerRadius = UDim.new(0, 6)
    SearchCorner.Parent = SearchBar
    
    local SearchIcon = Instance.new("TextLabel")
    SearchIcon.Parent = SearchBar
    SearchIcon.BackgroundTransparency = 1
    SearchIcon.Position = UDim2.new(0, 8, 0, 0)
    SearchIcon.Size = UDim2.new(0, 28, 1, 0)
    SearchIcon.Font = Enum.Font.GothamBold
    SearchIcon.Text = "üîç"
    SearchIcon.TextColor3 = Colors.TextDark
    SearchIcon.TextSize = 14
    
    local SearchBox = Instance.new("TextBox")
    SearchBox.Parent = SearchBar
    SearchBox.BackgroundTransparency = 1
    SearchBox.Position = UDim2.new(0, 35, 0, 0)
    SearchBox.Size = UDim2.new(1, -40, 1, 0)
    SearchBox.Font = Enum.Font.Gotham
    SearchBox.PlaceholderText = "Search"
    SearchBox.Text = ""
    SearchBox.TextColor3 = Colors.Text
    SearchBox.TextSize = 12
    SearchBox.TextXAlignment = Enum.TextXAlignment.Left
    
    -- Sidebar
    local Sidebar = Instance.new("ScrollingFrame")
    Sidebar.Name = "Sidebar"
    Sidebar.Parent = Main
    Sidebar.BackgroundColor3 = Colors.Sidebar
    Sidebar.BorderSizePixel = 0
    Sidebar.Position = UDim2.new(0, 0, 0, 50)
    Sidebar.Size = UDim2.new(0, 220, 1, -50)
    Sidebar.ScrollBarThickness = 0
    Sidebar.CanvasSize = UDim2.new(0, 0, 0, 0)
    
    -- Sidebar Border
    local SidebarBorder = Instance.new("Frame")
    SidebarBorder.Parent = Sidebar
    SidebarBorder.BackgroundColor3 = Colors.Border
    SidebarBorder.BorderSizePixel = 0
    SidebarBorder.Position = UDim2.new(1, -1, 0, 0)
    SidebarBorder.Size = UDim2.new(0, 1, 1, 0)
    
    local SidebarLayout = Instance.new("UIListLayout")
    SidebarLayout.Parent = Sidebar
    SidebarLayout.SortOrder = Enum.SortOrder.LayoutOrder
    SidebarLayout.Padding = UDim.new(0, 5)
    
    SidebarLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        Sidebar.CanvasSize = UDim2.new(0, 0, 0, SidebarLayout.AbsoluteContentSize.Y + 10)
    end)
    
    local SidebarPadding = Instance.new("UIPadding")
    SidebarPadding.Parent = Sidebar
    SidebarPadding.PaddingTop = UDim.new(0, 10)
    
    -- Content
    local Content = Instance.new("Frame")
    Content.Name = "Content"
    Content.Parent = Main
    Content.BackgroundColor3 = Colors.Background
    Content.BorderSizePixel = 0
    Content.Position = UDim2.new(0, 220, 0, 50)
    Content.Size = UDim2.new(1, -220, 1, -50)
    
    -- Dragging
    local dragging = false
    local dragInput, mousePos, framePos
    
    TopBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            mousePos = input.Position
            framePos = Main.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - mousePos
            Main.Position = UDim2.new(
                framePos.X.Scale, framePos.X.Offset + delta.X,
                framePos.Y.Scale, framePos.Y.Offset + delta.Y
            )
        end
    end)
    
    -- Close
    CloseBtn.MouseButton1Click:Connect(function()
        Tween(Main, {Size = UDim2.new(0, 0, 0, 0)}, 0.25)
        wait(0.25)
        ScreenGui:Destroy()
    end)
    
    -- Minimize
    local minimized = false
    MinBtn.MouseButton1Click:Connect(function()
        minimized = not minimized
        Tween(Main, {Size = minimized and UDim2.new(0, 900, 0, 50) or UDim2.new(0, 900, 0, 550)}, 0.25)
    end)
    
    -- Toggle UI
    local visible = true
    UserInputService.InputBegan:Connect(function(input, gpe)
        if gpe then return end
        if input.KeyCode == Enum.KeyCode.Backslash then
            visible = not visible
            Tween(Main, {Position = visible and UDim2.new(0.5, 0, 0.5, 0) or UDim2.new(0.5, 0, 1.5, 0)}, 0.3)
        end
    end)
    
    local Window = {}
    Window.Tabs = {}
    Window.Categories = {}
    Window.CurrentTab = nil
    Window.Elements = {}
    
    -- Theme Switcher Function
    function Window:SetTheme(theme)
        Library.Theme = theme
        Colors = Themes[theme]
        
        -- Update all colors
        Main.BackgroundColor3 = Colors.Background
        TopBar.BackgroundColor3 = Colors.TopBar
        TopFix.BackgroundColor3 = Colors.TopBar
        TopBorder.BackgroundColor3 = Colors.Border
        Sidebar.BackgroundColor3 = Colors.Sidebar
        SidebarBorder.BackgroundColor3 = Colors.Border
        Content.BackgroundColor3 = Colors.Background
        SearchBar.BackgroundColor3 = Colors.Element
        SearchBar.BorderColor3 = Colors.Border
        Title.TextColor3 = Colors.Text
        Subtitle.TextColor3 = Colors.TextDark
        SearchIcon.TextColor3 = Colors.TextDark
        SearchBox.TextColor3 = Colors.Text
        Shadow.ImageColor3 = Colors.Shadow
        
        -- Update all elements
        for _, element in pairs(Window.Elements) do
            if element.Type == "Toggle" or element.Type == "Dropdown" or element.Type == "Slider" or element.Type == "Button" then
                if element.Frame then
                    element.Frame.BackgroundColor3 = Colors.Element
                end
                if element.Label then
                    element.Label.TextColor3 = Colors.Text
                end
                if element.Desc then
                    element.Desc.TextColor3 = Colors.TextDark
                end
                if element.Icon then
                    element.Icon.TextColor3 = Colors.TextDark
                end
            end
        end
        
        -- Update categories
        for _, cat in pairs(Window.Categories) do
            for _, btn in pairs(cat.Buttons) do
                if btn.Button.BackgroundColor3 ~= Colors.Selected then
                    btn.Button.BackgroundColor3 = Colors.Sidebar
                end
                if btn.Icon.TextColor3 ~= Colors.Text then
                    btn.Icon.TextColor3 = Colors.TextDark
                end
                btn.Label.TextColor3 = Colors.Text
            end
        end
    end
    
    -- Create Category
    function Window:CreateCategory(name)
        local Category = {}
        Category.Name = name
        Category.Buttons = {}
        
        local CategoryFrame = Instance.new("Frame")
        CategoryFrame.Name = name
        CategoryFrame.Parent = Sidebar
        CategoryFrame.BackgroundTransparency = 1
        CategoryFrame.Size = UDim2.new(1, 0, 0, 30)
        
        local CategoryLabel = Instance.new("TextLabel")
        CategoryLabel.Parent = CategoryFrame
        CategoryLabel.BackgroundTransparency = 1
        CategoryLabel.Position = UDim2.new(0, 20, 0, 8)
        CategoryLabel.Size = UDim2.new(1, -40, 0, 20)
        CategoryLabel.Font = Enum.Font.GothamBold
        CategoryLabel.Text = name
        CategoryLabel.TextColor3 = Colors.TextDark
        CategoryLabel.TextSize = 11
        CategoryLabel.TextXAlignment = Enum.TextXAlignment.Left
        
        local Arrow = Instance.new("TextLabel")
        Arrow.Parent = CategoryLabel
        Arrow.BackgroundTransparency = 1
        Arrow.Position = UDim2.new(1, -15, 0, 0)
        Arrow.Size = UDim2.new(0, 15, 1, 0)
        Arrow.Font = Enum.Font.GothamBold
        Arrow.Text = "‚ñº"
        Arrow.TextColor3 = Colors.TextDark
        Arrow.TextSize = 8
        
        local ButtonContainer = Instance.new("Frame")
        ButtonContainer.Parent = CategoryFrame
        ButtonContainer.BackgroundTransparency = 1
        ButtonContainer.Position = UDim2.new(0, 0, 0, 30)
        ButtonContainer.Size = UDim2.new(1, 0, 0, 0)
        ButtonContainer.ClipsDescendants = true
        
        local ButtonLayout = Instance.new("UIListLayout")
        ButtonLayout.Parent = ButtonContainer
        ButtonLayout.SortOrder = Enum.SortOrder.LayoutOrder
        ButtonLayout.Padding = UDim.new(0, 2)
        
        local expanded = true
        
        local CategoryBtn = Instance.new("TextButton")
        CategoryBtn.Parent = CategoryLabel
        CategoryBtn.BackgroundTransparency = 1
        CategoryBtn.Size = UDim2.new(1, 0, 1, 0)
        CategoryBtn.Text = ""
        
        local function updateSize()
            if expanded then
                local contentHeight = 0
                for _, btn in pairs(Category.Buttons) do
                    contentHeight = contentHeight + 32
                end
                ButtonContainer.Size = UDim2.new(1, 0, 0, contentHeight)
                CategoryFrame.Size = UDim2.new(1, 0, 0, 30 + contentHeight)
            else
                ButtonContainer.Size = UDim2.new(1, 0, 0, 0)
                CategoryFrame.Size = UDim2.new(1, 0, 0, 30)
            end
        end
        
        CategoryBtn.MouseButton1Click:Connect(function()
            expanded = not expanded
            Tween(Arrow, {Rotation = expanded and 0 or -90}, 0.2)
            
            if expanded then
                local contentHeight = 0
                for _ in pairs(Category.Buttons) do
                    contentHeight = contentHeight + 32
                end
                Tween(ButtonContainer, {Size = UDim2.new(1, 0, 0, contentHeight)}, 0.25)
                Tween(CategoryFrame, {Size = UDim2.new(1, 0, 0, 30 + contentHeight)}, 0.25)
            else
                Tween(ButtonContainer, {Size = UDim2.new(1, 0, 0, 0)}, 0.25)
                Tween(CategoryFrame, {Size = UDim2.new(1, 0, 0, 30)}, 0.25)
            end
        end)
        
        function Category:CreateButton(name, icon, callback)
            local Button = Instance.new("TextButton")
            Button.Name = name
            Button.Parent = ButtonContainer
            Button.BackgroundColor3 = Colors.Sidebar
            Button.BorderSizePixel = 0
            Button.Size = UDim2.new(1, -20, 0, 30)
            Button.Position = UDim2.new(0, 10, 0, 0)
            Button.AutoButtonColor = false
            Button.Text = ""
            
            local BtnCorner = Instance.new("UICorner")
            BtnCorner.CornerRadius = UDim.new(0, 6)
            BtnCorner.Parent = Button
            
            local Icon = Instance.new("TextLabel")
            Icon.Parent = Button
            Icon.BackgroundTransparency = 1
            Icon.Position = UDim2.new(0, 10, 0, 0)
            Icon.Size = UDim2.new(0, 30, 1, 0)
            Icon.Font = Enum.Font.GothamBold
            Icon.Text = icon or "‚óè"
            Icon.TextColor3 = Colors.Selected
            Icon.TextSize = 14
            Icon.TextXAlignment = Enum.TextXAlignment.Left
            
            local Label = Instance.new("TextLabel")
            Label.Parent = Button
            Label.BackgroundTransparency = 1
            Label.Position = UDim2.new(0, 35, 0, 0)
            Label.Size = UDim2.new(1, -40, 1, 0)
            Label.Font = Enum.Font.Gotham
            Label.Text = name
            Label.TextColor3 = Colors.Text
            Label.TextSize = 12
            Label.TextXAlignment = Enum.TextXAlignment.Left
            
            Button.MouseEnter:Connect(function()
                if Button.BackgroundColor3 ~= Colors.Selected then
                    Tween(Button, {BackgroundColor3 = Colors.SidebarHover}, 0.15)
                end
            end)
            
            Button.MouseLeave:Connect(function()
                if Button.BackgroundColor3 ~= Colors.Selected then
                    Tween(Button, {BackgroundColor3 = Colors.Sidebar}, 0.15)
                end
            end)
            
            local Tab = Window:CreateTab(name)
            
            Button.MouseButton1Click:Connect(function()
                for _, cat in pairs(Window.Categories) do
                    for _, btn in pairs(cat.Buttons) do
                        btn.Button.BackgroundColor3 = Colors.Sidebar
                        btn.Icon.TextColor3 = Colors.TextDark
                    end
                end
                
                Button.BackgroundColor3 = Colors.Selected
                Icon.TextColor3 = Colors.Text
                
                for _, tab in pairs(Window.Tabs) do
                    tab.Visible = false
                end
                Tab.Visible = true
                Window.CurrentTab = Tab
                
                if callback then
                    callback()
                end
            end)
            
            table.insert(Category.Buttons, {Button = Button, Icon = Icon, Label = Label, Tab = Tab})
            
            updateSize()
            
            return Tab
        end
        
        table.insert(Window.Categories, Category)
        return Category
    end
    
    function Window:CreateTab(name)
        local Tab = Instance.new("ScrollingFrame")
        Tab.Name = name
        Tab.Parent = Content
        Tab.BackgroundTransparency = 1
        Tab.BorderSizePixel = 0
        Tab.Size = UDim2.new(1, 0, 1, 0)
        Tab.ScrollBarThickness = 4
        Tab.ScrollBarImageColor3 = Colors.Accent
        Tab.Visible = false
        Tab.CanvasSize = UDim2.new(0, 0, 0, 0)
        
        local TabPadding = Instance.new("UIPadding")
        TabPadding.Parent = Tab
        TabPadding.PaddingTop = UDim.new(0, 15)
        TabPadding.PaddingLeft = UDim.new(0, 15)
        TabPadding.PaddingRight = UDim.new(0, 15)
        TabPadding.PaddingBottom = UDim.new(0, 15)
        
        local TabLayout = Instance.new("UIListLayout")
        TabLayout.Parent = Tab
        TabLayout.SortOrder = Enum.SortOrder.LayoutOrder
        TabLayout.Padding = UDim.new(0, 15)
        
        TabLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            Tab.CanvasSize = UDim2.new(0, 0, 0, TabLayout.AbsoluteContentSize.Y + 30)
        end)
        
        table.insert(Window.Tabs, Tab)
        
        local Elements = {}
        
        function Elements:CreateSection(name)
            local Section = Instance.new("Frame")
            Section.Parent = Tab
            Section.BackgroundTransparency = 1
            Section.Size = UDim2.new(1, 0, 0, 0)
            
            local SectionLabel = Instance.new("TextLabel")
            SectionLabel.Parent = Section
            SectionLabel.BackgroundTransparency = 1
            SectionLabel.Size = UDim2.new(1, 0, 0, 25)
            SectionLabel.Font = Enum.Font.GothamBold
            SectionLabel.Text = name
            SectionLabel.TextColor3 = Colors.Text
            SectionLabel.TextSize = 14
            SectionLabel.TextXAlignment = Enum.TextXAlignment.Left
            
            local SectionContainer = Instance.new("Frame")
            SectionContainer.Parent = Section
            SectionContainer.BackgroundTransparency = 1
            SectionContainer.Position = UDim2.new(0, 0, 0, 30)
            SectionContainer.Size = UDim2.new(1, 0, 0, 0)
            
            local SectionLayout = Instance.new("UIListLayout")
            SectionLayout.Parent = SectionContainer
            SectionLayout.SortOrder = Enum.SortOrder.LayoutOrder
            SectionLayout.Padding = UDim.new(0, 8)
            
            SectionLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
                SectionContainer.Size = UDim2.new(1, 0, 0, SectionLayout.AbsoluteContentSize.Y)
                Section.Size = UDim2.new(1, 0, 0, SectionLayout.AbsoluteContentSize.Y + 35)
            end)
            
            local SectionElements = {}
            
            function SectionElements:CreateButton(config)
                config = config or {}
                local text = config.Name or "Button"
                local callback = config.Callback or function() end
                
                local Button = Instance.new("TextButton")
                Button.Parent = SectionContainer
                Button.BackgroundColor3 = Colors.Accent
                Button.BorderSizePixel = 0
                Button.Size = UDim2.new(1, 0, 0, 38)
                Button.Font = Enum.Font.GothamMedium
                Button.Text = text
                Button.TextColor3 = Color3.fromRGB(255, 255, 255)
                Button.TextSize = 13
                Button.AutoButtonColor = false
                
                local BtnCorner = Instance.new("UICorner")
                BtnCorner.CornerRadius = UDim.new(0, 8)
                BtnCorner.Parent = Button
                
                Button.MouseEnter:Connect(function()
                    Tween(Button, {BackgroundColor3 = Color3.fromRGB(10, 132, 255)}, 0.15)
                end)
                
                Button.MouseLeave:Connect(function()
                    Tween(Button, {BackgroundColor3 = Colors.Accent}, 0.15)
                end)
                
                Button.MouseButton1Click:Connect(function()
                    pcall(callback)
                end)
                
                table.insert(Window.Elements, {Type = "Button", Frame = Button})
                
                return Button
            end
            
            function SectionElements:CreateToggle(config)
                config = config or {}
                local text = config.Name or "Toggle"
                local desc = config.Description
                local default = config.Default or false
                local callback = config.Callback or function() end
                
                local Toggle = Instance.new("Frame")
                Toggle.Parent = SectionContainer
                Toggle.BackgroundColor3 = Colors.Element
                Toggle.BorderSizePixel = 1
                Toggle.BorderColor3 = Colors.Border
                Toggle.Size = UDim2.new(1, 0, 0, desc and 55 or 45)
                
                local ToggleCorner = Instance.new("UICorner")
                ToggleCorner.CornerRadius = UDim.new(0, 8)
                ToggleCorner.Parent = Toggle
                
                local Icon = Instance.new("TextLabel")
                Icon.Parent = Toggle
                Icon.BackgroundTransparency = 1
                Icon.Position = UDim2.new(0, 12, 0, desc and 8 or 12)
                Icon.Size = UDim2.new(0, 20, 0, 20)
                Icon.Font = Enum.Font.GothamBold
                Icon.Text = config.Icon or "‚úï"
                Icon.TextColor3 = Colors.TextDark
                Icon.TextSize = 14
                
                local Label = Instance.new("TextLabel")
                Label.Parent = Toggle
                Label.BackgroundTransparency = 1
                Label.Position = UDim2.new(0, 40, 0, desc and 8 or 12)
                Label.Size = UDim2.new(1, -120, 0, 20)
                Label.Font = Enum.Font.GothamMedium
                Label.Text = text
                Label.TextColor3 = Colors.Text
                Label.TextSize = 13
                Label.TextXAlignment = Enum.TextXAlignment.Left
                
                local Desc
                if desc then
                    Desc = Instance.new("TextLabel")
                    Desc.Parent = Toggle
                    Desc.BackgroundTransparency = 1
                    Desc.Position = UDim2.new(0, 40, 0, 28)
                    Desc.Size = UDim2.new(1, -120, 0, 18)
                    Desc.Font = Enum.Font.Gotham
                    Desc.Text = desc
                    Desc.TextColor3 = Colors.TextDark
                    Desc.TextSize = 11
                    Desc.TextXAlignment = Enum.TextXAlignment.Left
                end
                
                local ToggleBtn = Instance.new("TextButton")
                ToggleBtn.Parent = Toggle
                ToggleBtn.BackgroundColor3 = default and Colors.Accent or Color3.fromRGB(200, 200, 205)
                ToggleBtn.BorderSizePixel = 0
                ToggleBtn.Position = UDim2.new(1, -55, 0.5, -11)
                ToggleBtn.Size = UDim2.new(0, 45, 0, 22)
                ToggleBtn.Text = ""
                ToggleBtn.AutoButtonColor = false
                
                local ToggleBtnCorner = Instance.new("UICorner")
                ToggleBtnCorner.CornerRadius = UDim.new(1, 0)
                ToggleBtnCorner.Parent = ToggleBtn
                
                local Circle = Instance.new("Frame")
                Circle.Parent = ToggleBtn
                Circle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                Circle.BorderSizePixel = 0
                Circle.Position = default and UDim2.new(1, -20, 0.5, -9) or UDim2.new(0, 2, 0.5, -9)
                Circle.Size = UDim2.new(0, 18, 0, 18)
                
                local CircleCorner = Instance.new("UICorner")
                CircleCorner.CornerRadius = UDim.new(1, 0)
                CircleCorner.Parent = Circle
                
                local toggled = default
                Library.Flags[text] = toggled
                
                ToggleBtn.MouseButton1Click:Connect(function()
                    toggled = not toggled
                    Library.Flags[text] = toggled
                    
                    if toggled then
                        Tween(ToggleBtn, {BackgroundColor3 = Colors.Accent}, 0.2)
                        Tween(Circle, {Position = UDim2.new(1, -20, 0.5, -9)}, 0.2)
                    else
                        Tween(ToggleBtn, {BackgroundColor3 = Color3.fromRGB(200, 200, 205)}, 0.2)
                        Tween(Circle, {Position = UDim2.new(0, 2, 0.5, -9)}, 0.2)
                    end
                    
                    pcall(callback, toggled)
                end)
                
                table.insert(Window.Elements, {Type = "Toggle", Frame = Toggle, Label = Label, Desc = Desc, Icon = Icon})
                
                return Toggle
            end
            
            function SectionElements:CreateSlider(config)
                config = config or {}
                local text = config.Name or "Slider"
                local min = config.Min or 0
                local max = config.Max or 100
                local default = config.Default or min
                local callback = config.Callback or function() end
                
                local Slider = Instance.new("Frame")
                Slider.Parent = SectionContainer
                Slider.BackgroundColor3 = Colors.Element
                Slider.BorderSizePixel = 1
                Slider.BorderColor3 = Colors.Border
                Slider.Size = UDim2.new(1, 0, 0, 50)
                
                local SliderCorner = Instance.new("UICorner")
                SliderCorner.CornerRadius = UDim.new(0, 8)
                SliderCorner.Parent = Slider
                
                local Label = Instance.new("TextLabel")
                Label.Parent = Slider
                Label.BackgroundTransparency = 1
                Label.Position = UDim2.new(0, 12, 0, 8)
                Label.Size = UDim2.new(1, -70, 0, 16)
                Label.Font = Enum.Font.GothamMedium
                Label.Text = text
                Label.TextColor3 = Colors.Text
                Label.TextSize = 13
                Label.TextXAlignment = Enum.TextXAlignment.Left
                
                local Value = Instance.new("TextLabel")
                Value.Parent = Slider
                Value.BackgroundTransparency = 1
                Value.Position = UDim2.new(1, -55, 0, 8)
                Value.Size = UDim2.new(0, 45, 0, 16)
                Value.Font = Enum.Font.GothamBold
                Value.Text = tostring(default)
                Value.TextColor3 = Colors.Accent
                Value.TextSize = 13
                Value.TextXAlignment = Enum.TextXAlignment.Right
                
                local SliderBack = Instance.new("Frame")
                SliderBack.Parent = Slider
                SliderBack.BackgroundColor3 = Color3.fromRGB(220, 220, 225)
                SliderBack.BorderSizePixel = 0
                SliderBack.Position = UDim2.new(0, 12, 1, -16)
                SliderBack.Size = UDim2.new(1, -24, 0, 6)
                
                local BackCorner = Instance.new("UICorner")
                BackCorner.CornerRadius = UDim.new(1, 0)
                BackCorner.Parent = SliderBack
                
                local SliderFill = Instance.new("Frame")
                SliderFill.Parent = SliderBack
                SliderFill.BackgroundColor3 = Colors.Accent
                SliderFill.BorderSizePixel = 0
                SliderFill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
                
                local FillCorner = Instance.new("UICorner")
                FillCorner.CornerRadius = UDim.new(1, 0)
                FillCorner.Parent = SliderFill
                
                local SliderBtn = Instance.new("TextButton")
                SliderBtn.Parent = SliderBack
                SliderBtn.BackgroundColor3 = Colors.Accent
                SliderBtn.BorderSizePixel = 0
                SliderBtn.Position = UDim2.new((default - min) / (max - min), -6, 0.5, -6)
                SliderBtn.Size = UDim2.new(0, 12, 0, 12)
                SliderBtn.Text = ""
                SliderBtn.AutoButtonColor = false
                
                local BtnCorner = Instance.new("UICorner")
                BtnCorner.CornerRadius = UDim.new(1, 0)
                BtnCorner.Parent = SliderBtn
                
                local dragging = false
                local currentValue = default
                Library.Flags[text] = currentValue
                
                local function update(input)
                    local pos = math.clamp((input.Position.X - SliderBack.AbsolutePosition.X) / SliderBack.AbsoluteSize.X, 0, 1)
                    currentValue = math.floor(min + (max - min) * pos)
                    
                    Library.Flags[text] = currentValue
                    Value.Text = tostring(currentValue)
                    
                    SliderFill.Size = UDim2.new(pos, 0, 1, 0)
                    SliderBtn.Position = UDim2.new(pos, -6, 0.5, -6)
                    
                    pcall(callback, currentValue)
                end
                
                SliderBtn.MouseButton1Down:Connect(function()
                    dragging = true
                end)
                
                UserInputService.InputEnded:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        dragging = false
                    end
                end)
                
                UserInputService.InputChanged:Connect(function(input)
                    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                        update(input)
                    end
                end)
                
                SliderBack.InputBegan:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        update(input)
                    end
                end)
                
                table.insert(Window.Elements, {Type = "Slider", Frame = Slider, Label = Label})
                
                return Slider
            end
            
            function SectionElements:CreateDropdown(config)
                config = config or {}
                local text = config.Name or "Dropdown"
                local desc = config.Description
                local options = config.Options or {"Option 1"}
                local default = config.Default or options[1]
                local callback = config.Callback or function() end
                
                local Dropdown = Instance.new("Frame")
                Dropdown.Parent = SectionContainer
                Dropdown.BackgroundColor3 = Colors.Element
                Dropdown.BorderSizePixel = 1
                Dropdown.BorderColor3 = Colors.Border
                Dropdown.Size = UDim2.new(1, 0, 0, desc and 55 or 45)
                Dropdown.ClipsDescendants = true
                
                local DropCorner = Instance.new("UICorner")
                DropCorner.CornerRadius = UDim.new(0, 8)
                DropCorner.Parent = Dropdown
                
                local Icon = Instance.new("TextLabel")
                Icon.Parent = Dropdown
                Icon.BackgroundTransparency = 1
                Icon.Position = UDim2.new(0, 12, 0, desc and 8 or 12)
                Icon.Size = UDim2.new(0, 20, 0, 20)
                Icon.Font = Enum.Font.GothamBold
                Icon.Text = config.Icon or "?"
                Icon.TextColor3 = Colors.TextDark
                Icon.TextSize = 14
                
                local Label = Instance.new("TextLabel")
                Label.Parent = Dropdown
                Label.BackgroundTransparency = 1
                Label.Position = UDim2.new(0, 40, 0, desc and 8 or 12)
                Label.Size = UDim2.new(1, -340, 0, 20)
                Label.Font = Enum.Font.GothamMedium
                Label.Text = text
                Label.TextColor3 = Colors.Text
                Label.TextSize = 13
                Label.TextXAlignment = Enum.TextXAlignment.Left
                
                local Desc
                if desc then
                    Desc = Instance.new("TextLabel")
                    Desc.Parent = Dropdown
                    Desc.BackgroundTransparency = 1
                    Desc.Position = UDim2.new(0, 40, 0, 28)
                    Desc.Size = UDim2.new(1, -340, 0, 18)
                    Desc.Font = Enum.Font.Gotham
                    Desc.Text = desc
                    Desc.TextColor3 = Colors.TextDark
                    Desc.TextSize = 11
                    Desc.TextXAlignment = Enum.TextXAlignment.Left
                end
                
                local DropBtn = Instance.new("TextButton")
                DropBtn.Parent = Dropdown
                DropBtn.BackgroundColor3 = Color3.fromRGB(240, 240, 245)
                DropBtn.BorderSizePixel = 1
                DropBtn.BorderColor3 = Colors.Border
                DropBtn.Position = UDim2.new(1, -285, 0, desc and 12 or 10)
                DropBtn.Size = UDim2.new(0, 270, 0, 25)
                DropBtn.Font = Enum.Font.Gotham
                DropBtn.Text = " " .. default
                DropBtn.TextColor3 = Colors.Text
                DropBtn.TextSize = 11
                DropBtn.TextXAlignment = Enum.TextXAlignment.Left
                DropBtn.AutoButtonColor = false
                
                local DropBtnCorner = Instance.new("UICorner")
                DropBtnCorner.CornerRadius = UDim.new(0, 5)
                DropBtnCorner.Parent = DropBtn
                
                local Arrow = Instance.new("TextLabel")
                Arrow.Parent = DropBtn
                Arrow.BackgroundTransparency = 1
                Arrow.Position = UDim2.new(1, -20, 0, 0)
                Arrow.Size = UDim2.new(0, 20, 1, 0)
                Arrow.Font = Enum.Font.GothamBold
                Arrow.Text = "‚ñº"
                Arrow.TextColor3 = Colors.TextDark
                Arrow.TextSize = 8
                
                local DropList = Instance.new("Frame")
                DropList.Parent = Dropdown
                DropList.BackgroundColor3 = Color3.fromRGB(250, 250, 252)
                DropList.BorderSizePixel = 1
                DropList.BorderColor3 = Colors.Border
                DropList.Position = UDim2.new(1, -285, 0, desc and 42 or 40)
                DropList.Size = UDim2.new(0, 270, 0, 0)
                DropList.Visible = false
                DropList.ClipsDescendants = true
                
                local ListCorner = Instance.new("UICorner")
                ListCorner.CornerRadius = UDim.new(0, 5)
                ListCorner.Parent = DropList
                
                local ListLayout = Instance.new("UIListLayout")
                ListLayout.Parent = DropList
                ListLayout.SortOrder = Enum.SortOrder.LayoutOrder
                
                local opened = false
                local selected = default
                Library.Flags[text] = selected
                
                for _, option in ipairs(options) do
                    local OptBtn = Instance.new("TextButton")
                    OptBtn.Parent = DropList
                    OptBtn.BackgroundColor3 = Color3.fromRGB(250, 250, 252)
                    OptBtn.BorderSizePixel = 0
                    OptBtn.Size = UDim2.new(1, 0, 0, 25)
                    OptBtn.Font = Enum.Font.Gotham
                    OptBtn.Text = " " .. option
                    OptBtn.TextColor3 = Colors.Text
                    OptBtn.TextSize = 11
                    OptBtn.TextXAlignment = Enum.TextXAlignment.Left
                    OptBtn.AutoButtonColor = false
                    
                    OptBtn.MouseEnter:Connect(function()
                        OptBtn.BackgroundColor3 = Color3.fromRGB(235, 235, 240)
                    end)
                    
                    OptBtn.MouseLeave:Connect(function()
                        OptBtn.BackgroundColor3 = Color3.fromRGB(250, 250, 252)
                    end)
                    
                    OptBtn.MouseButton1Click:Connect(function()
                        selected = option
                        Library.Flags[text] = selected
                        DropBtn.Text = " " .. option
                        
                        opened = false
                        Tween(DropList, {Size = UDim2.new(0, 270, 0, 0)}, 0.2)
                        Tween(Dropdown, {Size = UDim2.new(1, 0, 0, desc and 55 or 45)}, 0.2)
                        Tween(Arrow, {Rotation = 0}, 0.2)
                        wait(0.2)
                        DropList.Visible = false
                        
                        pcall(callback, option)
                    end)
                end
                
                DropBtn.MouseButton1Click:Connect(function()
                    opened = not opened
                    
                    if opened then
                        local listSize = #options * 25
                        DropList.Visible = true
                        Tween(DropList, {Size = UDim2.new(0, 270, 0, listSize)}, 0.2)
                        Tween(Dropdown, {Size = UDim2.new(1, 0, 0, (desc and 60 or 50) + listSize)}, 0.2)
                        Tween(Arrow, {Rotation = 180}, 0.2)
                    else
                        Tween(DropList, {Size = UDim2.new(0, 270, 0, 0)}, 0.2)
                        Tween(Dropdown, {Size = UDim2.new(1, 0, 0, desc and 55 or 45)}, 0.2)
                        Tween(Arrow, {Rotation = 0}, 0.2)
                        wait(0.2)
                        DropList.Visible = false
                    end
                end)
                
                table.insert(Window.Elements, {Type = "Dropdown", Frame = Dropdown, Label = Label, Desc = Desc, Icon = Icon})
                
                return Dropdown
            end
            
            return SectionElements
        end
        
        return Elements
    end
    
    -- Auto-create Settings Category
    task.spawn(function()
        wait(0.1)
        local Settings = Window:CreateCategory("Settings")
        local SettingsTab = Settings:CreateButton("UI Settings", "‚öôÔ∏è")
        
        local ThemeSection = SettingsTab:CreateSection("Appearance")
        
        ThemeSection:CreateToggle({
            Name = "Dark Mode",
            Description = "Switch between Light and Dark theme.",
            Icon = "üåô",
            Default = false,
            Callback = function(value)
                Window:SetTheme(value and "Dark" or "Light")
            end
        })
        
        ThemeSection:CreateDropdown({
            Name = "Accent Color",
            Description = "Choose UI accent color.",
            Icon = "üé®",
            Options = {"Blue", "Purple", "Pink", "Green", "Red"},
            Default = "Blue",
            Callback = function(value)
                local accentColors = {
                    Blue = Color3.fromRGB(0, 122, 255),
                    Purple = Color3.fromRGB(159, 122, 234),
                    Pink = Color3.fromRGB(236, 72, 153),
                    Green = Color3.fromRGB(52, 199, 89),
                    Red = Color3.fromRGB(255, 59, 48)
                }
                Colors.Accent = accentColors[value]
                Themes.Light.Accent = accentColors[value]
                Themes.Dark.Accent = accentColors[value]
            end
        })
        
        local UISection = SettingsTab:CreateSection("UI Settings")
        
        UISection:CreateSlider({
            Name = "UI Scale",
            Min = 80,
            Max = 120,
            Default = 100,
            Callback = function(value)
                local scale = value / 100
                Main.Size = UDim2.new(0, 900 * scale, 0, 550 * scale)
            end
        })
        
        UISection:CreateToggle({
            Name = "Animations",
            Description = "Enable or disable UI animations.",
            Icon = "‚ú®",
            Default = true
        })
        
        UISection:CreateButton({
            Name = "Reset Position",
            Callback = function()
                Tween(Main, {Position = UDim2.new(0.5, 0, 0.5, 0)}, 0.3)
            end
        })
        
        local InfoSection = SettingsTab:CreateSection("Information")
        
        InfoSection:CreateButton({
            Name = "Check for Updates",
            Callback = function()
                print("Checking for updates...")
            end
        })
    end)
    
    return Window
end

return Library
